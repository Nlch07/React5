<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AstikChat | Premium</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, signInWithPopup, GoogleAuthProvider, GithubAuthProvider,
            signInWithEmailAndPassword, createUserWithEmailAndPassword,
            onAuthStateChanged, signOut, signInAnonymously, updateProfile 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, onValue, set, update, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDppgpIDC7lsqkyKanmWnt6aRmkV8sRfck",
            authDomain: "astikchat-2356f.firebaseapp.com",
            databaseURL: "https://astikchat-2356f-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "astikchat-2356f",
            storageBucket: "astikchat-2356f.firebasestorage.app",
            messagingSenderId: "481971458258",
            appId: "1:481971458258:web:131953007028cc61be5d0b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        window.fb = { 
            auth, db, GoogleAuthProvider, GithubAuthProvider,
            signInWithPopup, signOut, signInAnonymously, onAuthStateChanged, 
            signInWithEmailAndPassword, createUserWithEmailAndPassword,
            updateProfile, ref, push, onValue, set, update, get, remove
        };
    </script>

    <style>
        :root { --main-blue: #1565C0; --bg: #f0f2f5; --green: #25D366; --red: #ff3b30; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; margin: 0; font-family: -apple-system, sans-serif; background: #f0f2f5; overflow: hidden; }
        
        #root { display: flex; flex-direction: column; height: 100vh; height: 100dvh; background: white; max-width: 500px; margin: 0 auto; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        header { background: var(--main-blue); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .logo { font-size: 1.5rem; font-weight: 900; margin: 0; }

        .top-menu { background: #fff; padding: 12px 15px; border-bottom: 1px solid #eee; }
        .menu-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .btn { border: none; background: #f0f2f5; color: #333; padding: 8px 16px; border-radius: 20px; font-weight: 600; cursor: pointer; }
        .btn-online { background: #4CAF50; color: white; }
        .btn-delete { background: none; color: white; border: 1px solid white; padding: 5px 12px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; font-weight: 600; }

        .search-input { width: 100%; padding: 12px 15px; border-radius: 12px; border: none; background: #f0f2f5; outline: none; }

        .online-panel { padding: 15px; background: #fff; border-bottom: 8px solid #f0f2f5; }
        .section-title { font-size: 0.7rem; font-weight: 800; color: #999; text-transform: uppercase; margin-bottom: 10px; display: block; }
        .online-list { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 5px; }
        .online-user { display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; min-width: 65px; }

        .content-scroll { flex: 1; overflow-y: auto; }
        .chat-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #f5f5f5; cursor: pointer; }
.avatar { 
    width: 50px; 
    height: 50px; 
    border-radius: 50%; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    color: white; 
    font-weight: bold; 
    flex-shrink: 0; 
    background: #ccc; 
    position: relative; 
    /* overflow: hidden;  <-- –£–î–ê–õ–ò –≠–¢–£ –°–¢–†–û–ö–£ –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π */
}

.avatar img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
    border-radius: 50%; /* –î–æ–±–∞–≤—å —ç—Ç–æ —Å—é–¥–∞, —á—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞ –±—ã–ª–∞ –∫—Ä—É–≥–ª–æ–π */
}

.online-indicator { 
    position: absolute; 
    bottom: -1px; /* –ú–æ–∂–Ω–æ –¥–∞–∂–µ —á—É—Ç—å-—á—É—Ç—å –≤ –º–∏–Ω—É—Å, —á—Ç–æ–±—ã "–≤—ã–ª–µ–∑–ª–∞" –Ω–∞—Ä—É–∂—É */
    right: -1px; 
    width: 12px; 
    height: 12px; 
    background: #4CAF50; 
    border: 2px solid white; 
    border-radius: 50%; 
    z-index: 2; /* –ß—Ç–æ–±—ã —Ç–æ—á–∫–∞ –≤—Å–µ–≥–¥–∞ –±—ã–ª–∞ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
}
        
        .chat-info { flex: 1; margin-left: 15px; overflow: hidden; }
        .chat-name { font-weight: 700; display: block; margin-bottom: 2px; }
        .chat-preview { font-size: 0.9rem; color: #65676b; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block; }
        .unread-badge { background: var(--green); color: white; border-radius: 50%; min-width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; margin-top: 5px; }

        .chat-area { flex: 1; overflow-y: auto; background: #e5ddd5; padding: 15px; display: flex; flex-direction: column; gap: 6px; }
        .date-separator { align-self: center; background: rgba(0,0,0,0.08); color: #555; padding: 4px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; margin: 10px 0; text-transform: uppercase; }
        .unread-separator { align-self: center; background: #fff; color: #666; padding: 6px 20px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; margin: 15px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 100%; text-align: center; }

        .msg-wrap { display: flex; width: 100%; cursor: pointer; }
        .my-wrap { justify-content: flex-end; }
        .msg-bubble { max-width: 80%; padding: 8px 12px; border-radius: 15px; font-size: 0.95rem; box-shadow: 0 1px 1px rgba(0,0,0,0.1); position: relative; word-break: break-word; }
        .my-bubble { background: #dcf8c6; border-bottom-right-radius: 2px; }
        .other-bubble { background: white; border-bottom-left-radius: 2px; }
        .msg-time { font-size: 0.65rem; color: #888; display: block; text-align: right; margin-top: 4px; }
        .chat-link { color: #007bff; text-decoration: underline; }
        .reply-in-msg { background: rgba(0,0,0,0.05); border-left: 3px solid var(--main-blue); padding: 5px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 5px; }

        .input-bar-container { background: white; border-top: 1px solid #eee; display: flex; flex-direction: column; }
        .reply-preview { padding: 8px 15px; background: #f8f9fa; border-left: 4px solid var(--main-blue); display: flex; justify-content: space-between; font-size: 0.85rem; }
        .input-bar { padding: 10px 15px; display: flex; gap: 10px; align-items: center; }
        .input-bar input { flex: 1; border: none; padding: 12px 18px; border-radius: 24px; background: #f0f2f5; outline: none; }
        .send-btn { background: var(--main-blue); color: white; border: none; border-radius: 50%; width: 42px; height: 42px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .typing-status { font-size: 0.75rem; color: #adff2f; font-weight: bold; }
        .dot { width: 6px; height: 6px; background: #999; border-radius: 50%; animation: typingAnimation 1.4s infinite; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingAnimation { 0%, 60%, 100% { transform: translateY(0); opacity: 0.4; } 30% { transform: translateY(-4px); opacity: 1; } }

        /* AUTH STYLES */
        .login-screen { position: fixed; inset: 0; background: #f5f5f5; display: flex; align-items: center; justify-content: center; padding: 20px; z-index: 1000; }
        .login-card { background: white; padding: 35px 30px; border-radius: 25px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .app-logo { width: 60px; height: 60px; background: #005662; border-radius: 15px; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; }
        .login-card h1 { font-size: 26px; color: #333; margin-bottom: 10px; font-weight: 700; }
        .login-card p.desc { font-size: 14px; color: #777; margin-bottom: 25px; line-height: 1.4; }

        .email-form { display: flex; flex-direction: column; gap: 12px; }
        .input-group { position: relative; width: 100%; }
        .input-group input { width: 100%; padding: 15px 15px 15px 45px; border-radius: 12px; border: 1.5px solid #eee; outline: none; font-size: 1rem; transition: 0.3s; }
        .input-group input:focus { border-color: #005662; }
        .field-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.5; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .login-submit { background: #005662; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 1rem; margin-top: 10px; }
        .create-btn { background: white; color: #005662; border: 1.5px solid #eee; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 1rem; margin-top: 10px; width: 100%; }
        .social-btns { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .social-btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 12px; border: 1.5px solid #eee; border-radius: 12px; background: white; font-weight: 600; cursor: pointer; transition: 0.3s; }    </style>
</head>
<body>
    <div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    const BOT_ID = "ASTIK_BOT_ID";
    const BOT_PHRASES = [
        "67",
        "–¢—ã –º–æ–∂–µ—à—å —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —É–¥–µ—Ä–∂–∏–≤–∞—è –∏—Ö –ø–æ–ª —Å–µ–∫—É–Ω–¥—ã",
        "–¢—ã –º–æ–∂–µ—à—å –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–∂–∞–≤ –Ω–∞ –Ω–µ–≥–æ",
        "–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ —Å —á–µ–ª–æ–≤–µ–∫–æ–º –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É '–Ø –æ–Ω–ª–∞–π–Ω'",
    ];

    function App() {
        const [user, setUser] = useState(null);
        const [view, setView] = useState("hub");
        const [activeTab, setActiveTab] = useState("chats"); // –¢–í–û–Ø –ù–û–í–ê–Ø –ü–ï–†–ï–ú–ï–ù–ù–ê–Ø
        const [activeChat, setActiveChat] = useState(null);
        const [chatName, setChatName] = useState("");
        const [myChats, setMyChats] = useState([]);
        const [onlineUsers, setOnlineUsers] = useState([]);
        const [messages, setMessages] = useState([]);
        const [text, setText] = useState("");
        const [search, setSearch] = useState("");
        const [isPartnerTyping, setIsPartnerTyping] = useState(false);
        const [replyTo, setReplyTo] = useState(null);
        const [unreadIndex, setUnreadIndex] = useState(-1);
        
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [showPass, setShowPass] = useState(false);

        const scrollRef = useRef();
        const holdTimer = useRef(null);

        // --- 1. –¢–í–û–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
        const handleAnonymousAuth = async () => {
            try {
                const res = await window.fb.signInAnonymously(window.fb.auth);
                const anonName = "–ì–æ—Å—Ç—å " + Math.floor(Math.random() * 1000);
                await window.fb.updateProfile(res.user, { displayName: anonName });
                setUser({ ...res.user, displayName: anonName });
            } catch (err) { alert("–û—à–∏–±–∫–∞: " + err.message); }
        };

        useEffect(() => {
            return window.fb.onAuthStateChanged(window.fb.auth, u => { setUser(u); });
        }, []);

        // --- 2. –¢–í–û–Ø –õ–û–ì–ò–ö–ê –û–ù–õ–ê–ô–ù–ê ---
        useEffect(() => {
            if (user?.uid) {
                return window.fb.onValue(window.fb.ref(window.fb.db, 'presence'), s => {
                    const val = s.val() || {};
                    const active = Object.entries(val)
                        .map(([uid, data]) => ({ uid, ...data }))
                        .filter(u => (Date.now() - u.lastSeen < 5 * 60 * 1000)); 
                    setOnlineUsers([{ uid: BOT_ID, name: "–ë–æ—Ç", lastSeen: Date.now() }, ...active]);
                });
            }
        }, [user]);

        // --- 3. –¢–í–û–ò –ß–ê–¢–´ –ò –ë–û–¢ ---
        useEffect(() => {
            if (user?.uid) {
                return window.fb.onValue(window.fb.ref(window.fb.db, `userChats/${user.uid}`), s => {
                    const val = s.val();
                    setMyChats(val ? Object.values(val).sort((a,b) => b.lastTime - a.lastTime) : []);
                    
                    if (!val || !val[BOT_ID]) {
                        const botTime = Date.now();
                        const welcomeMsg = "–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ê—Å—Ç–∏–∫–æ–º. –ù–∞–ø–∏—à–∏ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!";
                        const chatId = [user.uid, BOT_ID].sort().join("_");
                        window.fb.update(window.fb.ref(window.fb.db, `userChats/${user.uid}/${BOT_ID}`), {
                            lastMsg: welcomeMsg, lastTime: botTime, partnerName: "–ë–æ—Ç", partnerUid: BOT_ID, unread: 1
                        });
                        window.fb.push(window.fb.ref(window.fb.db, `messages/private/${chatId}`), {
                            text: welcomeMsg, uid: BOT_ID, time: botTime
                        });
                    }
                });
            }
        }, [user]);

        // --- 4. –¢–í–û–ò –°–û–û–ë–©–ï–ù–ò–Ø –ò –¢–†–û–ï–¢–û–ß–ò–ï ---
        useEffect(() => {
            if (user && view === "chat" && activeChat) {
                const chatId = [user.uid, activeChat].sort().join("_");
                const chatData = myChats.find(c => c.partnerUid === activeChat);
                const count = chatData?.unread || 0;

                const msgUnsub = window.fb.onValue(window.fb.ref(window.fb.db, `messages/private/${chatId}`), s => {
                    const data = s.val();
                    const msgList = data ? Object.entries(data).map(([id, val]) => ({ id, ...val })) : [];
                    setMessages(msgList);
                    if (count > 0 && msgList.length >= count) setUnreadIndex(msgList.length - count);
                    else setUnreadIndex(-1);
                    setTimeout(() => scrollRef.current?.scrollIntoView({ behavior: 'smooth' }), 100);
                });

                window.fb.update(window.fb.ref(window.fb.db, `userChats/${user.uid}/${activeChat}`), { unread: 0 });

                const typingUnsub = window.fb.onValue(window.fb.ref(window.fb.db, `typing/${chatId}/${activeChat}`), s => {
                    setIsPartnerTyping(s.val() === true);
                });
                return () => { msgUnsub(); typingUnsub(); };
            }
        }, [view, activeChat, user, myChats]);

        // --- 5. –¢–í–û–ò –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é) ---
        const handleEmailAuth = async (e) => {
            e.preventDefault();
            try {
                await window.fb.signInWithEmailAndPassword(window.fb.auth, email, password)
                    .catch(async (err) => {
                        if(err.code === 'auth/user-not-found' || err.code === 'auth/invalid-credential') {
                            const res = await window.fb.createUserWithEmailAndPassword(window.fb.auth, email, password);
                            await window.fb.updateProfile(res.user, { displayName: email.split('@')[0] });
                        } else throw err;
                    });
            } catch (err) { alert(err.message); }
        };

        const handleSocialAuth = async (p) => {
            try { await window.fb.signInWithPopup(window.fb.auth, new window.fb[p]()); } 
            catch (err) { alert(err.message); }
        };

        const formatText = (txt) => {
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            return txt.split(urlRegex).map((part, i) => part.match(urlRegex) ? 
                <a key={i} href={part} target="_blank" rel="noopener noreferrer" className="chat-link" onClick={e => e.stopPropagation()}>{part}</a> : part);
        };

        const getDateLabel = (t) => {
            const d = new Date(t), now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
            if (t >= today) return "–°–µ–≥–æ–¥–Ω—è";
            if (t >= today - 86400000) return "–í—á–µ—Ä–∞";
            return d.toLocaleDateString([], { day: 'numeric', month: 'long' });
        };

        const changeDisplayName = async () => {
            const n = prompt("–ù–æ–≤–æ–µ –∏–º—è:", user.displayName);
            if (n && n.trim() !== user.displayName) {
                await window.fb.updateProfile(window.fb.auth.currentUser, { displayName: n.trim() });
                window.location.reload();
            }
        };

        const toggleOnline = () => {
            const isOn = onlineUsers.some(u => u.uid === user.uid);
            window.fb.set(window.fb.ref(window.fb.db, `presence/${user.uid}`), isOn ? null : { name: user.displayName || "–ê–Ω–æ–Ω–∏–º", lastSeen: Date.now() });
        };

        const handleTyping = (e) => {
            setText(e.target.value);
            if (activeChat && activeChat !== BOT_ID) {
                const chatId = [user.uid, activeChat].sort().join("_");
                window.fb.set(window.fb.ref(window.fb.db, `typing/${chatId}/${user.uid}`), true);
                clearTimeout(window.tOut);
                window.tOut = setTimeout(() => window.fb.set(window.fb.ref(window.fb.db, `typing/${chatId}/${user.uid}`), false), 2000);
            }
        };

        const sendMessage = async () => {
            if (!text.trim()) return;
            const time = Date.now(), chatId = [user.uid, activeChat].sort().join("_"), currentText = text;
            const msgData = { text: currentText, uid: user.uid, time, reply: replyTo ? { text: replyTo.text, name: replyTo.name } : null };
            setText(""); setReplyTo(null); setUnreadIndex(-1);
            window.fb.push(window.fb.ref(window.fb.db, `messages/private/${chatId}`), msgData);
            window.fb.update(window.fb.ref(window.fb.db, `userChats/${user.uid}/${activeChat}`), { 
                lastMsg: currentText, lastTime: time, partnerName: chatName, partnerUid: activeChat 
            });
            if (activeChat !== BOT_ID) {
                const pRef = window.fb.ref(window.fb.db, `userChats/${activeChat}/${user.uid}`);
                const s = await window.fb.get(pRef);
                window.fb.update(pRef, { lastMsg: currentText, lastTime: time, partnerName: user.displayName || "–ê–Ω–æ–Ω–∏–º", partnerUid: user.uid, unread: (s.val()?.unread || 0) + 1 });
            } else {
                window.fb.set(window.fb.ref(window.fb.db, `typing/${chatId}/${BOT_ID}`), true);
                setTimeout(() => {
                    const bTime = Date.now(), ph = BOT_PHRASES[Math.floor(Math.random() * BOT_PHRASES.length)];
                    window.fb.push(window.fb.ref(window.fb.db, `messages/private/${chatId}`), { text: ph, uid: BOT_ID, time: bTime });
                    window.fb.update(window.fb.ref(window.fb.db, `userChats/${user.uid}/${BOT_ID}`), { lastMsg: ph, lastTime: bTime, partnerName: "–ë–æ—Ç", partnerUid: BOT_ID });
                    window.fb.set(window.fb.ref(window.fb.db, `typing/${chatId}/${BOT_ID}`), false);
                }, 1500);
            }
        };

        const startHold = (id, isMy) => {
            if (!isMy) return;
            holdTimer.current = setTimeout(() => {
                if (confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö?")) {
                    const chatId = [user.uid, activeChat].sort().join("_");
                    window.fb.remove(window.fb.ref(window.fb.db, `messages/private/${chatId}/${id}`));
                }
            }, 800);
        };
        const stopHold = () => clearTimeout(holdTimer.current);

if (!user) return (
    <div className="login-screen">
        <div className="login-card">
            
            {/* 2. –ó–∞–≥–æ–ª–æ–≤–∫–∏ */}
            <h1>Sign In</h1>
            <p className="desc">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AstikChat,–≤–≤–µ–¥–∏—Ç–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É –∏ –ø–∞—Ä–æ–ª—å</p>

            {/* 3. –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ */}
            <form className="email-form" onSubmit={handleEmailAuth}>
                <div className="input-group">
                    <input type="email" placeholder="E-mail" value={email} onChange={e => setEmail(e.target.value)} required />
                </div>
                <div className="input-group">
                    <input type={showPass ? "text" : "password"} placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} required />
                    <span className="pass-toggle" onClick={() => setShowPass(!showPass)} style={{position:'absolute', right:15, top:'50%', transform:'translateY(-50%)', cursor:'pointer'}}>{showPass ? "üëÅÔ∏è" : "üîí"}</span>
                </div>
                <i class="fa-solid fa-key"></i>
                <div style={{textAlign: 'right'}}><a href="#" style={{color: '#005662', fontSize: '13px', textDecoration: 'none'}}>Forgot password?</a></div>
                
                <button type="submit" className="login-submit">Continue</button>
            </form>

            {/* 4. –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ (—Å—Ä–∞–∑—É –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π) */}
            <p style={{marginTop: '20px', fontSize: '14px', color: '#999'}}>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</p>
            <button className="create-btn" onClick={handleAnonymousAuth}>–í–æ–π—Ç–∏ –±–µ–∑ –ê–∫–∫–∞—É–Ω—Ç–∞</button>

            {/* 5. –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥—ã –≤ —Å–∞–º–æ–º –Ω–∏–∑—É */}
            <div className="social-btns">
                <button className="social-btn" onClick={() => handleSocialAuth('GoogleAuthProvider')}>
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"/>
                    Sign in with Google
                </button>
                <button className="social-btn" onClick={() => handleSocialAuth('GithubAuthProvider')}>
                    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="18"/>
                    Sign in with GitHub
                </button>
            </div>
        </div>
    </div>
);

        // --- –†–ï–ù–î–ï–†: 2. –û–ö–ù–û –ß–ê–¢–ê (–ü–ï–†–ï–ö–†–´–í–ê–ï–¢ –í–°–Å) ---
        if (view === "chat") return (
            <div className="main-container" style={{display:'flex', flexDirection:'column', height:'100vh', background:'#fff', position:'fixed', top:0, left:0, width:'100%', zIndex:1000}}>
                <header>
                    <div style={{display:'flex', alignItems:'center', gap:12}}>
                        <span onClick={() => {setView("hub"); setUnreadIndex(-1);}} style={{fontSize:'1.5rem', cursor:'pointer'}}>‚Üê</span>
                        <div className="avatar" style={{width:35, height:35, background: activeChat === BOT_ID ? '#546E7A' : '#ccc'}}>{chatName?.[0]}</div>
                        <div>
                            <b style={{fontSize:'1rem'}}>{chatName}</b>
                            {isPartnerTyping && <div className="typing-status">–ø–µ—á–∞—Ç–∞–µ—Ç...</div>}
                        </div>
                    </div>
                    <button className="btn-delete" onClick={() => confirm("–£–¥–∞–ª–∏—Ç—å?") && (activeChat !== BOT_ID ? window.fb.remove(window.fb.ref(window.fb.db, `userChats/${user.uid}/${activeChat}`)) : alert("–ù–µ–ª—å–∑—è!"), setView("hub"))}>–£–¥–∞–ª–∏—Ç—å</button>
                </header>
                <div className="chat-area">
                    {messages.map((m, i) => (
                        <React.Fragment key={m.id || i}>
                            {(i === 0 || getDateLabel(messages[i-1].time) !== getDateLabel(m.time)) && <div className="date-separator">{getDateLabel(m.time)}</div>}
                            {i === unreadIndex && <div className="unread-separator">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div>}
                            <div className={`msg-wrap ${m.uid === user.uid ? 'my-wrap' : ''}`} 
                                 onClick={() => setReplyTo({text: m.text, name: m.uid === user.uid ? '–í—ã' : chatName})}
                                 onMouseDown={() => startHold(m.id, m.uid === user.uid)} onMouseUp={stopHold} onTouchStart={() => startHold(m.id, m.uid === user.uid)} onTouchEnd={stopHold}>
                                <div className={`msg-bubble ${m.uid === user.uid ? 'my-bubble' : 'other-bubble'}`}>
                                    {m.reply && <div className="reply-in-msg"><b>{m.reply.name}</b><br/>{m.reply.text}</div>}
                                    {formatText(m.text)}
                                    <span className="msg-time">{new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                                </div>
                            </div>
                        </React.Fragment>
                    ))}
                    {isPartnerTyping && (
                        <div className="msg-wrap" style={{ justifyContent: 'flex-start', margin: '10px 0' }}>
                            <div className="msg-bubble other-bubble" style={{ 
                                display: 'flex', 
                                gap: '4px', 
                                padding: '12px 18px', 
                                borderRadius: '20px', 
                                alignItems: 'center',
                                width: 'fit-content' 
                            }}>
                                {[0, 0.2, 0.4].map((d, i) => (
                                    <div key={i} style={{
                                        width: '6px', height: '6px', background: '#aaa', borderRadius: '50%',
                                        animation: 'astikBounce 1.4s infinite ease-in-out', animationDelay: `${d}s`
                                    }}></div>
                                ))}
                            </div>
                            <style>{`
                                @keyframes astikBounce {
                                    0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
                                    40% { transform: translateY(-6px); opacity: 1; }
                                }
                            `}</style>
                        </div>
                    )}
                    <div ref={scrollRef} />
                </div>
                <div className="input-bar-container">
                    {replyTo && <div className="reply-preview"><span>–û—Ç–≤–µ—Ç <b>{replyTo.name}</b></span><span onClick={()=>setReplyTo(null)}>‚úï</span></div>}
                    <div className="input-bar">
                        <input value={text} onChange={handleTyping} onKeyPress={e => e.key === 'Enter' && sendMessage()} placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." />
                        <button className="send-btn" onClick={sendMessage}>‚û§</button>
                    </div>
                </div>
            </div>
        );

        // --- –†–ï–ù–î–ï–†: 3. –•–ê–ë (–ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù –° –í–ö–õ–ê–î–ö–ê–ú–ò) ---
        return (
            <div style={{display:'flex', flexDirection:'column', height:'100vh', background:'#fff'}}>
                <div style={{flex: 1, overflowY: 'auto', display: 'flex', flexDirection: 'column'}}>
                    
                    {/* –¢–í–û–Ø –í–ö–õ–ê–î–ö–ê –ß–ê–¢–û–í */}
                    {activeTab === 'chats' && (
                        <>
                            <header>
                                <h1 className="logo">AstikChat</h1>
                                <button className="btn" onClick={() => confirm("–í—ã–π—Ç–∏?") && window.fb.signOut(window.fb.auth)}>–í—ã—Ö–æ–¥</button>
                            </header>
                            <div className="top-menu">
                                <div className="menu-row">
                                    <div style={{display:'flex', alignItems:'center', gap:10}} onClick={changeDisplayName}>
                                        <div className="avatar" style={{width:35, height:35, background:'var(--main-blue)'}}>{user.displayName?.[0] || "?"}</div>
                                        <div style={{display:'flex', flexDirection:'column'}}>
                                            <b>{user.displayName || "–ê–Ω–æ–Ω–∏–º"}</b>
                                            <span style={{fontSize:'0.65rem', color:'var(--main-blue)'}}>–ò–∑–º–µ–Ω–∏—Ç—å ‚úé</span>
                                        </div>
                                    </div>
                                    <button className={`btn ${onlineUsers.some(u => u.uid === user.uid) ? '' : 'btn-online'}`} onClick={toggleOnline}>
                                        {onlineUsers.some(u => u.uid === user.uid) ? "–£–π—Ç–∏ –≤ —Ç–µ–Ω—å" : "–Ø –æ–Ω–ª–∞–π–Ω"}
                                    </button>
                                </div>
                                <input className="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –¥–∏–∞–ª–æ–≥–æ–≤..." value={search} onChange={e => setSearch(e.target.value)} />
                            </div>
                            <div className="content-scroll">
                                <div className="online-panel">
                                    <span className="section-title">–í —Å–µ—Ç–∏</span>
                                    <div className="online-list">
                                        {onlineUsers.map(u => (
                                            <div key={u.uid} className="online-user" onClick={() => u.uid !== user.uid && (setActiveChat(u.uid), setChatName(u.name), setView("chat"))}>
                                                <div className="avatar" style={{background: u.uid === user.uid ? 'var(--main-blue)' : (u.uid === BOT_ID ? '#546E7A' : '#eee'), border: '2px solid var(--green)'}}>{u.name?.[0]}<div className="online-indicator"></div></div>
                                                <span style={{fontSize:'0.75rem'}}>{u.uid === user.uid ? "–Ø" : u.name}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                {myChats.filter(c => c.partnerName?.toLowerCase().includes(search.toLowerCase())).map(c => (
                                    <div key={c.partnerUid} className="chat-item" onClick={() => {setActiveChat(c.partnerUid); setChatName(c.partnerName); setView("chat");}}>
                                        <div className="avatar" style={{background: c.partnerUid === BOT_ID ? '#546E7A' : '#ccc'}}>{c.partnerName?.[0]}</div>
                                        <div className="chat-info"><span className="chat-name">{c.partnerName}</span><span className="chat-preview">{c.lastMsg}</span></div>
                                        <div style={{display:'flex', flexDirection:'column', alignItems:'flex-end'}}>
                                            <span style={{fontSize:'0.7rem', color:'#999'}}>{new Date(c.lastTime).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                                            {c.unread > 0 && <div className="unread-badge">{c.unread}</div>}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </>
                    )}

                    {/* –í–ö–õ–ê–î–ö–ê –ë–õ–û–ì */}
                    {activeTab === 'blog' && (
                        <div style={{flex:1, display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center'}}>
                            <h2 style={{color:'#ccc'}}>–í—Ç–æ—Ä–æ–π —Ä–∞–∑–¥–µ–ª</h2>
                            <span style={{fontSize:'5rem'}}>üìù</span>
                            <p style={{color:'#999'}}>–Ø –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–¥—É–º–∞–ª —á—Ç–æ —Å –Ω–∏–º –¥–µ–∞–ª—Ç—å</p>
                        </div>
                    )}

                    {/* –í–ö–õ–ê–î–ö–ê –ü–†–û–§–ò–õ–¨ */}
{/* –í–ö–õ–ê–î–ö–ê –ü–†–û–§–ò–õ–¨ */}
{activeTab === 'profile' && (
    <div style={{padding: 20, textAlign:'center', maxWidth: 400, margin: '0 auto'}}>
        {/* –ê–≤–∞—Ç–∞—Ä –∏ –ò–Ω—Ñ–æ */}
        <div className="avatar" style={{width:100, height:100, margin:'20px auto', fontSize:'2.5rem', background:'var(--main-blue)', color:'white', display:'flex', alignItems:'center', justifyContent:'center', borderRadius:'50%', boxShadow:'0 10px 20px rgba(0,0,0,0.1)'}}>
            {user.displayName?.[0] || "?"}
        </div>
        <h2 style={{margin:'10px 0 5px'}}>{user.displayName || "–ê–Ω–æ–Ω–∏–º"}</h2>
        <p style={{color:'#999', marginBottom: 20}}>{user.email || "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω"}</p>

        {/* –ö–Ω–æ–ø–∫–∞: –°–º–µ–Ω–∏—Ç—å –∏–º—è (–ø—Ä–æ—Å—Ç–æ–π prompt, —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å –º–æ–¥–∞–ª–∫—É –∏ –Ω–µ –ª–æ–º–∞—Ç—å –∫–æ–¥) */}
        <button 
            style={{width:'100%', padding:'12px', borderRadius:'12px', border:'1px solid var(--main-blue)', background:'white', color:'var(--main-blue)', fontWeight:'600', marginBottom:10, cursor:'pointer'}}
            onClick={() => {
                const name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:", user.displayName);
                if (name && window.fb) {
                    window.fb.updateProfile(user, { displayName: name })
                        .then(() => alert("–ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ! –ü–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É."))
                        .catch(() => alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –∏–º–µ–Ω–∏"));
                }
            }}
        >
            ‚úé –°–º–µ–Ω–∏—Ç—å –∏–º—è
        </button>

{/* –ë–õ–û–ö: –ü–û–î–ï–õ–ò–¢–¨–°–Ø –° –î–†–£–ó–¨–Ø–ú–ò */}
<div style={{ marginTop: 25, textAlign: 'left' }}>
    <p style={{ fontSize: '0.85rem', color: '#666', marginBottom: 8, fontWeight: '600', paddingLeft: 5 }}>
        –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏:
    </p>


    {/* –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ */}
    <button 
        style={{
            width:'100%', 
            padding:'15px', 
            borderRadius:'12px', 
            border:'none', 
            background:'linear-gradient(45deg, #007bff, #00d2ff)', 
            color:'white', 
            fontWeight:'bold', 
            cursor:'pointer', 
            boxShadow:'0 5px 15px rgba(0,123,255,0.3)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            gap: '10px'
        }}
        onClick={() => {
            const shareData = {
                title: 'AstikChat',
                text: '–ó–∞—Ö–æ–¥–∏ –≤ –º–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä!',
                url: window.location.href
            };
            if (navigator.share) {
                navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            }
        }}
    >
        <span>üì¢</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
    </button>
</div>

        {/* –ö–Ω–æ–ø–∫–∞: –í—ã—Ö–æ–¥ */}
        <button className="btn-delete" style={{width:'100%', padding:15, borderRadius:'12px'}} onClick={() => window.fb.signOut(window.fb.auth)}>
            –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        </button>
    </div>
)}
                </div>

                {/* –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –ù–ê–í–ò–ì–ê–¶–ò–ò */}
                <div style={{display:'flex', height:'70px', background:'#fff', borderTop:'1px solid #eee', paddingBottom:'env(safe-area-inset-bottom)'}}>
                    <div onClick={() => setActiveTab('chats')} style={{flex:1, display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center', cursor:'pointer', color: activeTab === 'chats' ? 'var(--main-blue)' : '#999'}}>
                        <span style={{fontSize:'1.4rem'}}>üí¨</span><span style={{fontSize:'0.6rem', fontWeight:'bold'}}>–ß–ê–¢–´</span>
                    </div>
                    <div onClick={() => setActiveTab('blog')} style={{flex:1, display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center', cursor:'pointer', color: activeTab === 'blog' ? 'var(--main-blue)' : '#999'}}>
                        <span style={{fontSize:'1.4rem'}}>üìù</span><span style={{fontSize:'0.6rem', fontWeight:'bold'}}>–ë–õ–û–ì</span>
                    </div>
                    <div onClick={() => setActiveTab('profile')} style={{flex:1, display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center', cursor:'pointer', color: activeTab === 'profile' ? 'var(--main-blue)' : '#999'}}>
                        <span style={{fontSize:'1.4rem'}}>üë§</span><span style={{fontSize:'0.6rem', fontWeight:'bold'}}>–ü–†–û–§–ò–õ–¨</span>
                    </div>
                </div>
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
